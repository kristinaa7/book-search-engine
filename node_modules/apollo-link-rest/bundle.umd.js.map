{"version":3,"file":"bundle.umd.js","sources":["../src/utils/graphql.ts","../src/restLink.ts"],"sourcesContent":["/*\n  This file is a port of async.ts from the now-deprecated graphql-anywhere\n  package, which itself was based on the graphql fn from graphql-js.\n  Original source: https://github.com/apollographql/apollo-client/blob/release-2.x/packages/graphql-anywhere/src/async.ts\n\n  Utils that were previously imported from apollo-utilities can now be imported\n  from @apollo/client/utilities with the remaining types inlined in restLink.ts.\n*/\n\nimport {\n  DocumentNode,\n  SelectionSetNode,\n  FieldNode,\n  FragmentDefinitionNode,\n  InlineFragmentNode,\n  DirectiveNode,\n} from 'graphql';\n\nimport {\n  getMainDefinition,\n  getFragmentDefinitions,\n  createFragmentMap,\n  shouldInclude,\n  isField,\n  isInlineFragment,\n  resultKeyNameFromField,\n  argumentsObjectFromField,\n  FragmentMap,\n} from '@apollo/client/utilities';\n\nimport { DirectiveInfo, ExecInfo, Resolver } from '../restLink';\n\nfunction getDirectiveInfoFromField(\n  field: FieldNode,\n  variables: Object,\n): DirectiveInfo {\n  if (field.directives && field.directives.length) {\n    const directiveObj: DirectiveInfo = {};\n    field.directives.forEach((directive: DirectiveNode) => {\n      directiveObj[directive.name.value] = argumentsObjectFromField(\n        directive,\n        variables,\n      );\n    });\n    return directiveObj;\n  }\n  return null;\n}\n\ntype ResultMapper = (\n  values: { [fieldName: string]: any },\n  rootValue: any,\n) => any;\n\ntype FragmentMatcher = (\n  rootValue: any,\n  typeCondition: string,\n  context: any,\n) => boolean;\n\nexport type ExecContext = {\n  fragmentMap: FragmentMap;\n  contextValue: any;\n  variableValues: VariableMap;\n  resultMapper: ResultMapper;\n  resolver: Resolver;\n  fragmentMatcher: FragmentMatcher;\n};\n\ntype ExecOptions = {\n  resultMapper?: ResultMapper;\n  fragmentMatcher?: FragmentMatcher;\n};\n\nconst hasOwn = Object.prototype.hasOwnProperty;\n\nfunction merge(dest, src) {\n  if (src !== null && typeof src === 'object') {\n    Object.keys(src).forEach(key => {\n      const srcVal = src[key];\n      if (!hasOwn.call(dest, key)) {\n        dest[key] = srcVal;\n      } else {\n        merge(dest[key], srcVal);\n      }\n    });\n  }\n}\n\ntype VariableMap = { [name: string]: any };\n\n/* Based on graphql function from graphql-js:\n *\n * graphql(\n *   schema: GraphQLSchema,\n *   requestString: string,\n *   rootValue?: ?any,\n *   contextValue?: ?any,\n *   variableValues?: ?{[key: string]: any},\n *   operationName?: ?string\n * ): Promise<GraphQLResult>\n *\n */\nexport function graphql(\n  resolver: Resolver,\n  document: DocumentNode,\n  rootValue?: any,\n  contextValue?: any,\n  variableValues?: VariableMap,\n  execOptions: ExecOptions = {},\n): Promise<null | Object> {\n  const mainDefinition = getMainDefinition(document);\n\n  const fragments = getFragmentDefinitions(document);\n  const fragmentMap = createFragmentMap(fragments);\n\n  const resultMapper = execOptions.resultMapper;\n\n  // Default matcher always matches all fragments\n  const fragmentMatcher = execOptions.fragmentMatcher || (() => true);\n\n  const execContext: ExecContext = {\n    fragmentMap,\n    contextValue,\n    variableValues,\n    resultMapper,\n    resolver,\n    fragmentMatcher,\n  };\n\n  return executeSelectionSet(\n    mainDefinition.selectionSet as SelectionSetNode,\n    rootValue,\n    execContext,\n  );\n}\n\nasync function executeSelectionSet(\n  selectionSet: SelectionSetNode,\n  rootValue: any,\n  execContext: ExecContext,\n) {\n  const { fragmentMap, contextValue, variableValues: variables } = execContext;\n\n  const result = {};\n\n  const execute = async selection => {\n    if (!shouldInclude(selection, variables)) {\n      // Skip this entirely\n      return;\n    }\n\n    if (isField(selection)) {\n      const fieldResult = await executeField(\n        selection as FieldNode,\n        rootValue,\n        execContext,\n      );\n\n      const resultFieldKey = resultKeyNameFromField(selection);\n\n      if (fieldResult !== undefined) {\n        if (result[resultFieldKey] === undefined) {\n          result[resultFieldKey] = fieldResult;\n        } else {\n          merge(result[resultFieldKey], fieldResult);\n        }\n      }\n\n      return;\n    }\n\n    let fragment: InlineFragmentNode | FragmentDefinitionNode;\n\n    if (isInlineFragment(selection)) {\n      fragment = selection as InlineFragmentNode;\n    } else {\n      // This is a named fragment\n      fragment = fragmentMap[selection.name.value] as FragmentDefinitionNode;\n\n      if (!fragment) {\n        throw new Error(`No fragment named ${selection.name.value}`);\n      }\n    }\n\n    const typeCondition = fragment.typeCondition.name.value;\n\n    if (execContext.fragmentMatcher(rootValue, typeCondition, contextValue)) {\n      const fragmentResult = await executeSelectionSet(\n        fragment.selectionSet,\n        rootValue,\n        execContext,\n      );\n\n      merge(result, fragmentResult);\n    }\n  };\n\n  await Promise.all(selectionSet.selections.map(execute));\n\n  if (execContext.resultMapper) {\n    return execContext.resultMapper(result, rootValue);\n  }\n\n  return result;\n}\n\nasync function executeField(\n  field: FieldNode,\n  rootValue: any,\n  execContext: ExecContext,\n): Promise<null | Object> {\n  const { variableValues: variables, contextValue, resolver } = execContext;\n\n  const fieldName = field.name.value;\n  const args = argumentsObjectFromField(field, variables);\n\n  const info: ExecInfo = {\n    isLeaf: !field.selectionSet,\n    resultKey: resultKeyNameFromField(field),\n    directives: getDirectiveInfoFromField(field, variables),\n    field,\n  };\n\n  const result = await resolver(fieldName, rootValue, args, contextValue, info);\n\n  // Handle all scalar types here\n  if (!field.selectionSet) {\n    return result;\n  }\n\n  // From here down, the field has a selection set, which means it's trying to\n  // query a GraphQLObjectType\n  if (result == null) {\n    // Basically any field in a GraphQL response can be null, or missing\n    return result;\n  }\n\n  if (Array.isArray(result)) {\n    return executeSubSelectedArray(field, result, execContext);\n  }\n\n  // Returned value is an object, and the query has a sub-selection. Recurse.\n  return executeSelectionSet(field.selectionSet, result, execContext);\n}\n\nfunction executeSubSelectedArray(field, result, execContext) {\n  return Promise.all(\n    result.map(item => {\n      // null value in array\n      if (item === null) {\n        return null;\n      }\n\n      // This is a nested array, recurse\n      if (Array.isArray(item)) {\n        return executeSubSelectedArray(field, item, execContext);\n      }\n\n      // This is an object, run the selection set on it\n      return executeSelectionSet(field.selectionSet, item, execContext);\n    }),\n  );\n}\n","import {\n  OperationTypeNode,\n  OperationDefinitionNode,\n  FragmentDefinitionNode,\n  // Query Nodes\n  DirectiveNode,\n  DocumentNode,\n  FieldNode,\n  SelectionSetNode,\n} from 'graphql';\nimport {\n  ApolloLink,\n  Observable,\n  Operation,\n  NextLink,\n  FetchResult,\n} from '@apollo/client/core';\nimport {\n  hasDirectives,\n  getMainDefinition,\n  getFragmentDefinitions,\n  createFragmentMap,\n  addTypenameToDocument,\n  FragmentMap,\n  isField,\n  isInlineFragment,\n  resultKeyNameFromField,\n  checkDocument,\n  removeDirectivesFromDocument,\n} from '@apollo/client/utilities';\nimport { graphql } from './utils/graphql';\nimport * as qs from 'qs';\n\nexport type DirectiveInfo = {\n  [fieldName: string]: { [argName: string]: any };\n};\n\nexport type ExecInfo = {\n  isLeaf: boolean;\n  resultKey: string;\n  directives: DirectiveInfo;\n  field: FieldNode;\n};\n\nexport type Resolver = (\n  fieldName: string,\n  rootValue: any,\n  args: any,\n  context: any,\n  info: ExecInfo,\n) => any;\n\nexport namespace RestLink {\n  export type URI = string;\n\n  export type Endpoint = string;\n\n  export interface EndpointOptions {\n    uri: Endpoint;\n    responseTransformer?: ResponseTransformer | null;\n  }\n\n  export interface Endpoints {\n    [endpointKey: string]: Endpoint | EndpointOptions;\n  }\n\n  export type Header = string;\n  export interface HeadersHash {\n    [headerKey: string]: Header;\n  }\n  export type InitializationHeaders = HeadersHash | Headers | string[][];\n\n  export type HeadersMergePolicy = (...headerGroups: Headers[]) => Headers;\n\n  export interface FieldNameNormalizer {\n    (fieldName: string, keypath?: string[]): string;\n  }\n\n  export interface TypePatcherContext {\n    resolverParams: {\n      fieldName: string;\n      root: any;\n      args: any;\n      context: RequestContext;\n      info: ExecInfo;\n    };\n  }\n\n  /** injects __typename using user-supplied code */\n  export interface FunctionalTypePatcher {\n    (\n      data: any,\n      outerType: string,\n      patchDeeper: FunctionalTypePatcher,\n      context: TypePatcherContext,\n    ): any;\n  }\n  /** Table of mappers that help inject __typename per type described therein */\n  export interface TypePatcherTable {\n    [typename: string]: FunctionalTypePatcher;\n  }\n\n  export interface SerializedBody {\n    body: any;\n    headers: InitializationHeaders;\n  }\n\n  export interface Serializer {\n    (data: any, headers: Headers): SerializedBody;\n  }\n\n  export interface Serializers {\n    [bodySerializer: string]: Serializer;\n  }\n\n  export type CustomFetch = (\n    request: RequestInfo,\n    init: RequestInit,\n  ) => Promise<Response>;\n\n  export type ResponseTransformer = (data: any, typeName: string) => any;\n\n  export interface RestLinkHelperProps {\n    /** Arguments passed in via normal graphql parameters */\n    args: { [key: string]: any };\n    /** Arguments added via @export(as: ) directives */\n    exportVariables: { [key: string]: any };\n    /** Arguments passed directly to @rest(params: ) */\n    // params: { [key: string]: any };\n    /** Apollo Context */\n    context: { [key: string]: any };\n    /** All arguments passed to the `@rest(...)` directive */\n    '@rest': { [key: string]: any };\n  }\n  export interface PathBuilderProps extends RestLinkHelperProps {\n    replacer: (opts: RestLinkHelperProps) => string;\n  }\n\n  /**\n   * Used for any Error from the server when requests:\n   * - terminate with HTTP Status >= 300\n   * - and the response contains no data or errors\n   */\n  export type ServerError = Error & {\n    response: Response;\n    result: any;\n    statusCode: number;\n  };\n\n  export type Options = {\n    /**\n     * The URI to use when fetching operations.\n     *\n     * Optional if endpoints provides a default.\n     */\n    uri?: URI;\n\n    /**\n     * A root endpoint (uri) to apply paths to or a map of endpoints.\n     */\n    endpoints?: Endpoints;\n\n    /**\n     * An object representing values to be sent as headers on the request.\n     */\n    headers?: InitializationHeaders;\n\n    /**\n     * A function that takes the response field name and converts it into a GraphQL compliant name\n     *\n     * @note This is called *before* @see typePatcher so that it happens after\n     *       optional-field-null-insertion.\n     */\n    fieldNameNormalizer?: FieldNameNormalizer;\n\n    /**\n     * A function that takes a GraphQL-compliant field name and converts it back into an endpoint-specific name\n     * Can be overridden at the mutation-call-site (in the rest-directive).\n     */\n    fieldNameDenormalizer?: FieldNameNormalizer;\n\n    /**\n     * Structure to allow you to specify the __typename when you have nested objects in your REST response!\n     *\n     * If you want to force Required Properties, you can throw an error in your patcher,\n     *  or `delete` a field from the data response provided to your typePatcher function!\n     *\n     * @note: This is called *after* @see fieldNameNormalizer because that happens\n     *        after optional-nulls insertion, and those would clobber normalized names.\n     *\n     * @warning: We're not thrilled with this API, and would love a better alternative before we get to 1.0.0\n     *           Please see proposals considered in https://github.com/apollographql/apollo-link-rest/issues/48\n     *           And consider submitting alternate solutions to the problem!\n     */\n    typePatcher?: TypePatcherTable;\n\n    /**\n     * The credentials policy you want to use for the fetch call.\n     */\n    credentials?: 'omit' | 'same-origin' | 'include';\n\n    /**\n     * Use a custom fetch to handle REST calls.\n     */\n    customFetch?: CustomFetch;\n\n    /**\n     * Add serializers that will serialize the body before it is emitted and will pass on\n     * headers to update the request.\n     */\n    bodySerializers?: Serializers;\n\n    /**\n     * Set the default serializer for the link\n     * @default JSON serialization\n     */\n    defaultSerializer?: Serializer;\n\n    /**\n     * Parse the response body of an HTTP request into the format that Apollo expects.\n     */\n    responseTransformer?: ResponseTransformer;\n  };\n\n  /** @rest(...) Directive Options */\n  export interface DirectiveOptions {\n    /**\n     * What HTTP method to use.\n     * @default `GET`\n     */\n    method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n    /** What GraphQL type to name the response */\n    type?: string;\n    /**\n     * What path (including query) to use\n     * - @optional if you provide @see DirectiveOptions.pathBuilder\n     */\n    path?: string;\n    /**\n     * What endpoint to select from the map of endpoints available to this link.\n     * @default `RestLink.endpoints[DEFAULT_ENDPOINT_KEY]`\n     */\n    endpoint?: string;\n    /**\n     * Function that constructs a request path out of the Environmental\n     *  state when processing this @rest(...) call.\n     *\n     * - @optional if you provide: @see DirectiveOptions.path\n     * - **note**: providing this function means it's your responsibility to call\n     *             encodeURIComponent directly if needed!\n     *\n     * Warning: This is an Advanced API and we are looking for syntactic & ergonomics feedback.\n     */\n    pathBuilder?: (props: PathBuilderProps) => string;\n    /**\n     * Optional method that constructs a RequestBody out of the Environmental state\n     * when processing this @rest(...) call.\n     * @default function that extracts the bodyKey from the args.\n     *\n     * Warning: This is an Advanced API and we are looking for syntactic & ergonomics feedback.\n     */\n    bodyBuilder?: (props: RestLinkHelperProps) => object;\n    /**\n     * Optional field that defines the name of the env var to extract and use as the body\n     * @default \"input\"\n     * @see https://dev-blog.apollodata.com/designing-graphql-mutations-e09de826ed97\n     */\n    bodyKey?: string;\n\n    /**\n     * Optional serialization function or a key that will be used look up the serializer to serialize the request body before transport.\n     * @default if null will fallback to the default serializer\n     */\n    bodySerializer?: RestLink.Serializer | string;\n\n    /**\n     * A per-request name denormalizer, this permits special endpoints to have their\n     * field names remapped differently from the default.\n     * @default Uses RestLink.fieldNameDenormalizer\n     */\n    fieldNameDenormalizer?: RestLink.FieldNameNormalizer;\n    /**\n     * A per-request name normalizer, this permits special endpoints to have their\n     * field names remapped differently from the default.\n     * @default Uses RestLink.fieldNameDenormalizer\n     */\n    fieldNameNormalizer?: RestLink.FieldNameNormalizer;\n    /**\n     * A method to allow insertion of __typename deep in response objects\n     */\n    typePatcher?: RestLink.FunctionalTypePatcher;\n  }\n}\n\nconst popOneSetOfArrayBracketsFromTypeName = (typename: string): string => {\n  const noSpace = typename.replace(/\\s/g, '');\n  const sansOneBracketPair = noSpace.replace(\n    /\\[(.*)\\]/,\n    (str, matchStr, offset, fullStr) => {\n      return (\n        ((matchStr != null && matchStr.length) > 0 ? matchStr : null) || noSpace\n      );\n    },\n  );\n  return sansOneBracketPair;\n};\n\nconst addTypeNameToResult = (\n  result: any[] | object,\n  __typename: string,\n  typePatcher: RestLink.FunctionalTypePatcher,\n  typePatcherContext: RestLink.TypePatcherContext,\n): any[] | object => {\n  if (Array.isArray(result)) {\n    const fixedTypename = popOneSetOfArrayBracketsFromTypeName(__typename);\n    // Recursion needed for multi-dimensional arrays\n    return result.map(e =>\n      addTypeNameToResult(e, fixedTypename, typePatcher, typePatcherContext),\n    );\n  }\n  if (\n    null == result ||\n    typeof result === 'number' ||\n    typeof result === 'boolean' ||\n    typeof result === 'string'\n  ) {\n    return result;\n  }\n  return typePatcher(result, __typename, typePatcher, typePatcherContext);\n};\n\nconst quickFindRestDirective = (field: FieldNode): DirectiveNode | null => {\n  if (field.directives && field.directives.length) {\n    return field.directives.find(directive => 'rest' === directive.name.value);\n  }\n  return null;\n};\n/**\n * The way graphql works today, it doesn't hand us the AST tree for our query, it hands us the ROOT\n * This method searches for REST-directive-attached nodes that are named to match this query.\n *\n * A little bit of wasted compute, but alternative would be a patch in graphql-anywhere.\n *\n * @param resultKey SearchKey for REST directive-attached item matching this sub-query\n * @param current current node in the REST-JSON-response\n * @param mainDefinition Parsed Query Definition\n * @param fragmentMap Map of Named Fragments\n * @param currentSelectionSet Current selection set we're filtering by\n */\nfunction findRestDirectivesThenInsertNullsForOmittedFields(\n  resultKey: string,\n  current: any[] | object, // currentSelectionSet starts at root, so wait until we're inside a Field tagged with an @rest directive to activate!\n  mainDefinition: OperationDefinitionNode | FragmentDefinitionNode,\n  fragmentMap: FragmentMap,\n  currentSelectionSet: SelectionSetNode,\n): any[] | object {\n  if (\n    currentSelectionSet == null ||\n    null == current ||\n    typeof current === 'number' ||\n    typeof current === 'boolean' ||\n    typeof current === 'string'\n  ) {\n    return current;\n  }\n  currentSelectionSet.selections.forEach(node => {\n    if (isInlineFragment(node)) {\n      findRestDirectivesThenInsertNullsForOmittedFields(\n        resultKey,\n        current,\n        mainDefinition,\n        fragmentMap,\n        node.selectionSet,\n      );\n    } else if (node.kind === 'FragmentSpread') {\n      const fragment = fragmentMap[node.name.value];\n      findRestDirectivesThenInsertNullsForOmittedFields(\n        resultKey,\n        current,\n        mainDefinition,\n        fragmentMap,\n        fragment.selectionSet,\n      );\n    } else if (isField(node)) {\n      const name = resultKeyNameFromField(node);\n      if (name === resultKey && quickFindRestDirective(node) != null) {\n        // Jackpot! We found our selectionSet!\n        insertNullsForAnyOmittedFields(\n          current,\n          mainDefinition,\n          fragmentMap,\n          node.selectionSet,\n        );\n      } else {\n        findRestDirectivesThenInsertNullsForOmittedFields(\n          resultKey,\n          current,\n          mainDefinition,\n          fragmentMap,\n          node.selectionSet,\n        );\n      }\n    } else {\n      // This will give a TypeScript build-time error if you did something wrong or the AST changes!\n      return ((node: never): never => {\n        throw new Error('Unhandled Node Type in SelectionSetNode.selections');\n      })(node);\n    }\n  });\n  // Return current to have our result pass to next link in async promise chain!\n  return current;\n}\n/**\n * Recursively walks a handed object in parallel with the Query SelectionSet,\n *  and inserts `null` for any field that is missing from the response.\n *\n * This is needed because ApolloClient will throw an error automatically if it's\n *  missing -- effectively making all of rest-link's selections implicitly non-optional.\n *\n * If you want to implement required fields, you need to use typePatcher to *delete*\n *  fields when they're null and you want the query to fail instead.\n *\n * @param current Current object we're patching\n * @param mainDefinition Parsed Query Definition\n * @param fragmentMap Map of Named Fragments\n * @param currentSelectionSet Current selection set we're filtering by\n */\nfunction insertNullsForAnyOmittedFields(\n  current: any[] | object, // currentSelectionSet starts at root, so wait until we're inside a Field tagged with an @rest directive to activate!\n  mainDefinition: OperationDefinitionNode | FragmentDefinitionNode,\n  fragmentMap: FragmentMap,\n  currentSelectionSet: SelectionSetNode,\n): void {\n  if (\n    null == current ||\n    typeof current === 'number' ||\n    typeof current === 'boolean' ||\n    typeof current === 'string'\n  ) {\n    return;\n  }\n  if (Array.isArray(current)) {\n    // If our current value is an array, process our selection set for each entry.\n    current.forEach(c =>\n      insertNullsForAnyOmittedFields(\n        c,\n        mainDefinition,\n        fragmentMap,\n        currentSelectionSet,\n      ),\n    );\n    return;\n  }\n  currentSelectionSet.selections.forEach(node => {\n    if (isInlineFragment(node)) {\n      insertNullsForAnyOmittedFields(\n        current,\n        mainDefinition,\n        fragmentMap,\n        node.selectionSet,\n      );\n    } else if (node.kind === 'FragmentSpread') {\n      const fragment = fragmentMap[node.name.value];\n      insertNullsForAnyOmittedFields(\n        current,\n        mainDefinition,\n        fragmentMap,\n        fragment.selectionSet,\n      );\n    } else if (isField(node)) {\n      const value = current[node.name.value];\n      if (node.name.value === '__typename') {\n        // Don't mess with special fields like __typename\n      } else if (typeof value === 'undefined') {\n        // Patch in a null where the field would have been marked as missing\n        current[node.name.value] = null;\n      } else if (\n        value != null &&\n        typeof value === 'object' &&\n        node.selectionSet != null\n      ) {\n        insertNullsForAnyOmittedFields(\n          value,\n          mainDefinition,\n          fragmentMap,\n          node.selectionSet,\n        );\n      } else {\n        // Other types (string, number) do not need recursive patching!\n      }\n    } else {\n      // This will give a TypeScript build-time error if you did something wrong or the AST changes!\n      return ((node: never): never => {\n        throw new Error('Unhandled Node Type in SelectionSetNode.selections');\n      })(node);\n    }\n  });\n}\n\nconst getEndpointOptions = (\n  endpoints: RestLink.Endpoints,\n  endpoint: RestLink.Endpoint,\n): RestLink.EndpointOptions => {\n  const result =\n    endpoints[endpoint || DEFAULT_ENDPOINT_KEY] ||\n    endpoints[DEFAULT_ENDPOINT_KEY];\n\n  if (typeof result === 'string') {\n    return { uri: result };\n  }\n\n  return {\n    responseTransformer: null,\n    ...result,\n  };\n};\n\n/** Replaces params in the path, keyed by colons */\nconst replaceLegacyParam = (\n  endpoint: string,\n  name: string,\n  value: string,\n): string => {\n  if (value === undefined || name === undefined) {\n    return endpoint;\n  }\n  return endpoint.replace(`:${name}`, value);\n};\n\n/** Internal Tool that Parses Paths for RestLink -- This API should be considered experimental */\nexport class PathBuilder {\n  /** For accelerating the replacement of paths that are used a lot */\n  private static cache: {\n    [path: string]: (props: RestLink.PathBuilderProps) => string;\n  } = {};\n  /** Table to limit the amount of nagging (due to probable API Misuse) we do to once per path per launch */\n  private static warnTable: { [key: string]: true } = {};\n  /** Regexp that finds things that are eligible for variable replacement */\n  private static argReplacement = /({[._a-zA-Z0-9]*})/;\n\n  static replacerForPath(\n    path: string,\n  ): (props: RestLink.PathBuilderProps) => string {\n    if (path in PathBuilder.cache) {\n      return PathBuilder.cache[path];\n    }\n\n    const queryOrigStartIndex = path.indexOf('?');\n    const pathBits = path.split(PathBuilder.argReplacement);\n\n    const chunkActions: Array<\n      | true // We're enabling the qs-encoder\n      | string // This is a raw string bit, don't mess with it\n      | ((props: RestLink.RestLinkHelperProps, useQSEncoder: boolean) => string)\n    > = [];\n\n    let hasBegunQuery = false;\n    pathBits.reduce((processedCount, bit) => {\n      if (bit === '' || bit === '{}') {\n        // Empty chunk, do nothing\n        return processedCount + bit.length;\n      }\n      const nextIndex = processedCount + bit.length;\n      if (bit[0] === '{' && bit[bit.length - 1] === '}') {\n        // Replace some args!\n        const _keyPath = bit.slice(1, bit.length - 1).split('.');\n\n        chunkActions.push(\n          (props: RestLink.RestLinkHelperProps, useQSEncoder: boolean) => {\n            try {\n              const value = PathBuilderLookupValue(props, _keyPath);\n              if (\n                !useQSEncoder ||\n                (typeof value !== 'object' || value == null)\n              ) {\n                return String(value);\n              } else {\n                return qs.stringify(value);\n              }\n            } catch (e) {\n              const key = [path, _keyPath.join('.')].join('|');\n              if (!(key in PathBuilder.warnTable)) {\n                console.warn(\n                  'Warning: RestLink caught an error while unpacking',\n                  key,\n                  \"This tends to happen if you forgot to pass a parameter needed for creating an @rest(path, or if RestLink was configured to deeply unpack a path parameter that wasn't provided. This message will only log once per detected instance. Trouble-shooting hint: check @rest(path: and the variables provided to this query.\",\n                );\n                PathBuilder.warnTable[key] = true;\n              }\n              return '';\n            }\n          },\n        );\n      } else {\n        chunkActions.push(bit);\n        if (!hasBegunQuery && nextIndex >= queryOrigStartIndex) {\n          hasBegunQuery = true;\n          chunkActions.push(true);\n        }\n      }\n      return nextIndex;\n    }, 0);\n\n    const result: (props: RestLink.PathBuilderProps) => string = props => {\n      let hasEnteredQuery = false;\n      const tmp = chunkActions.reduce((accumulator: string, action): string => {\n        if (typeof action === 'string') {\n          return accumulator + action;\n        } else if (typeof action === 'boolean') {\n          hasEnteredQuery = true;\n          return accumulator;\n        } else {\n          return accumulator + action(props, hasEnteredQuery);\n        }\n      }, '') as string;\n      return tmp;\n    };\n    return (PathBuilder.cache[path] = result);\n  }\n}\n\n/** Private Helper Function */\nfunction PathBuilderLookupValue(tmp: object, keyPath: string[]) {\n  if (keyPath.length === 0) {\n    return tmp;\n  }\n  const remainingKeyPath = [...keyPath]; // Copy before mutating\n  const key = remainingKeyPath.shift();\n  return PathBuilderLookupValue(tmp[key], remainingKeyPath);\n}\n\n/**\n * Some keys should be passed through transparently without normalizing/de-normalizing\n */\nconst noMangleKeys = ['__typename'];\n\n/** Trivial globalThis polyfill that falls-back to our previous global object in case people had polyfilled that */\nconst globalScope = (typeof globalThis === 'object' && globalThis) || global;\n\n/** Recursively descends the provided object tree and converts all the keys */\nconst convertObjectKeys = (\n  object: object,\n  __converter: RestLink.FieldNameNormalizer,\n  keypath: string[] = [],\n): object => {\n  let converter: RestLink.FieldNameNormalizer = null;\n  if (__converter.length != 2) {\n    converter = (name, keypath) => {\n      return __converter(name);\n    };\n  } else {\n    converter = __converter;\n  }\n\n  if (Array.isArray(object)) {\n    return object.map((o, index) =>\n      convertObjectKeys(o, converter, [...keypath, String(index)]),\n    );\n  }\n\n  if (\n    object == null ||\n    typeof object !== 'object' ||\n    object.constructor !== Object\n  ) {\n    // Object is a scalar or null / undefined => no keys to convert!\n    return object;\n  }\n\n  // FileList/File are only available in some browser contexts\n  // Notably: *not available* in react-native.\n  if (\n    ((globalScope as any).FileList && object instanceof FileList) ||\n    ((globalScope as any).File && object instanceof File)\n  ) {\n    // Object is a FileList or File object => no keys to convert!\n    return object;\n  }\n\n  return Object.keys(object).reduce((acc: any, key: string) => {\n    let value = object[key];\n\n    if (noMangleKeys.indexOf(key) !== -1) {\n      acc[key] = value;\n      return acc;\n    }\n\n    const nestedKeyPath = [...keypath, key];\n    acc[converter(key, nestedKeyPath)] = convertObjectKeys(\n      value,\n      converter,\n      nestedKeyPath,\n    );\n    return acc;\n  }, {});\n};\n\nconst noOpNameNormalizer: RestLink.FieldNameNormalizer = (name: string) => {\n  return name;\n};\n\n/**\n * Helper that makes sure our headers are of the right type to pass to Fetch\n */\nexport const normalizeHeaders = (\n  headers: RestLink.InitializationHeaders,\n): Headers => {\n  // Make sure that our headers object is of the right type\n  if (headers instanceof Headers) {\n    return headers;\n  } else {\n    return new Headers(headers || {});\n  }\n};\n\n/**\n * Returns a new Headers Group that contains all the headers.\n * - If there are duplicates, they will be in the returned header set multiple times!\n */\nexport const concatHeadersMergePolicy: RestLink.HeadersMergePolicy = (\n  ...headerGroups: Headers[]\n): Headers => {\n  return headerGroups.reduce((accumulator, current) => {\n    if (!current) {\n      return accumulator;\n    }\n    if (!current.forEach) {\n      current = normalizeHeaders(current);\n    }\n    current.forEach((value, key) => {\n      accumulator.append(key, value);\n    });\n\n    return accumulator;\n  }, new Headers());\n};\n\n/**\n * This merge policy deletes any matching headers from the link's default headers.\n * - Pass headersToOverride array & a headers arg to context and this policy will automatically be selected.\n */\nexport const overrideHeadersMergePolicy = (\n  linkHeaders: Headers,\n  headersToOverride: string[],\n  requestHeaders: Headers | null,\n): Headers => {\n  const result = new Headers();\n  linkHeaders.forEach((value, key) => {\n    if (headersToOverride.indexOf(key) !== -1) {\n      return;\n    }\n    result.append(key, value);\n  });\n  return concatHeadersMergePolicy(result, requestHeaders || new Headers());\n};\nexport const overrideHeadersMergePolicyHelper = overrideHeadersMergePolicy; // Deprecated name\n\nconst makeOverrideHeadersMergePolicy = (\n  headersToOverride: string[],\n): RestLink.HeadersMergePolicy => {\n  return (linkHeaders, requestHeaders) => {\n    return overrideHeadersMergePolicy(\n      linkHeaders,\n      headersToOverride,\n      requestHeaders,\n    );\n  };\n};\n\nconst SUPPORTED_HTTP_VERBS = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'];\n\nexport const validateRequestMethodForOperationType = (\n  method: string,\n  operationType: OperationTypeNode,\n): void => {\n  switch (operationType) {\n    case 'query':\n      if (SUPPORTED_HTTP_VERBS.indexOf(method.toUpperCase()) !== -1) {\n        return;\n      }\n      throw new Error(\n        `A \"query\" operation can only support \"GET\" requests but got \"${method}\".`,\n      );\n    case 'mutation':\n      if (SUPPORTED_HTTP_VERBS.indexOf(method.toUpperCase()) !== -1) {\n        return;\n      }\n      throw new Error('\"mutation\" operations do not support that HTTP-verb');\n    case 'subscription':\n      throw new Error('A \"subscription\" operation is not supported yet.');\n    default:\n      const _exhaustiveCheck: never = operationType;\n      return _exhaustiveCheck;\n  }\n};\n\n/**\n * Utility to build & throw a JS Error from a \"failed\" REST-response\n * @param response: HTTP Response object for this request\n * @param result: Promise that will render the body of the response\n * @param message: Human-facing error message\n */\nconst rethrowServerSideError = (\n  response: Response,\n  result: any,\n  message: string,\n) => {\n  const error = new Error(message) as RestLink.ServerError;\n\n  error.response = response;\n  error.statusCode = response.status;\n  error.result = result;\n\n  throw error;\n};\n\n/** Apollo-Link getContext, provided from the user & mutated by upstream links */\ninterface LinkChainContext {\n  /** Credentials Policy for Fetch */\n  credentials?: RequestCredentials | null;\n\n  /** Headers the user wants to set on this request. See also headersMergePolicy */\n  headers?: RestLink.InitializationHeaders | null;\n\n  /** Will default to concatHeadersMergePolicy unless headersToOverride is set */\n  headersMergePolicy?: RestLink.HeadersMergePolicy | null;\n\n  /** List of headers to override, passing this will swap headersMergePolicy if necessary */\n  headersToOverride?: string[] | null;\n\n  /** An array of the responses from each fetched URL, useful for accessing headers in earlier links */\n  restResponses?: Response[];\n}\n\n/** Context passed via graphql() to our resolver */\ninterface RequestContext {\n  /** Headers the user wants to set on this request. See also headersMergePolicy */\n  headers: Headers;\n\n  /** Credentials Policy for Fetch */\n  credentials?: RequestCredentials | null;\n\n  /** Exported variables fulfilled in this request, using @export(as:). They are stored keyed by node to support deeply nested structures with exports at multiple levels */\n  exportVariablesByNode: Map<any, { [key: string]: any }>;\n\n  endpoints: RestLink.Endpoints;\n  customFetch: RestLink.CustomFetch;\n  operationType: OperationTypeNode;\n  fieldNameNormalizer: RestLink.FieldNameNormalizer;\n  fieldNameDenormalizer: RestLink.FieldNameNormalizer;\n  mainDefinition: OperationDefinitionNode | FragmentDefinitionNode;\n  fragmentDefinitions: FragmentDefinitionNode[];\n  typePatcher: RestLink.FunctionalTypePatcher;\n  serializers: RestLink.Serializers;\n  responseTransformer: RestLink.ResponseTransformer;\n\n  /** An array of the responses from each fetched URL */\n  responses: Response[];\n}\n\nconst addTypeToNode = (node, typename) => {\n  if (node === null || node === undefined || typeof node !== 'object') {\n    return node;\n  }\n\n  if (!Array.isArray(node)) {\n    node['__typename'] = typename;\n    return node;\n  }\n\n  return node.map(item => {\n    return addTypeToNode(item, typename);\n  });\n};\n\nconst resolver: Resolver = async (\n  fieldName: string,\n  root: any,\n  args: any,\n  context: RequestContext,\n  info: ExecInfo,\n) => {\n  const { directives, isLeaf, resultKey } = info;\n  const { exportVariablesByNode } = context;\n\n  const exportVariables = exportVariablesByNode.get(root) || {};\n\n  /** creates a copy of this node's export variables for its child nodes. iterates over array results to provide for each child. returns the passed result. */\n  const copyExportVariables = <T>(result: T): T => {\n    if (result instanceof Array) {\n      result.forEach(copyExportVariables);\n    } else {\n      // export variables are stored keyed on the node they are for\n      exportVariablesByNode.set(result, { ...exportVariables });\n    }\n\n    return result;\n  };\n\n  // Support GraphQL Aliases!\n  const aliasedNode = (root || {})[resultKey];\n  const preAliasingNode = (root || {})[fieldName];\n\n  if (root && directives && directives.export) {\n    // @export(as:) is only supported with apollo-link-rest at this time\n    // so use the preAliasingNode as we're responsible for implementing aliasing!\n    exportVariables[directives.export.as] = preAliasingNode;\n  }\n\n  const isATypeCall = directives && directives.type;\n\n  if (!isLeaf && isATypeCall) {\n    // @type(name: ) is only supported inside apollo-link-rest at this time\n    // so use the preAliasingNode as we're responsible for implementing aliasing!\n    // Also: exit early, since @type(name: ) && @rest() can't both exist on the same node.\n    if (directives.rest) {\n      throw new Error(\n        'Invalid use of @type(name: ...) directive on a call that also has @rest(...)',\n      );\n    }\n    copyExportVariables(preAliasingNode);\n    return addTypeToNode(preAliasingNode, directives.type.name);\n  }\n\n  const isNotARestCall = !directives || !directives.rest;\n  if (isNotARestCall) {\n    // This is not tagged with @rest()\n    // This might not belong to us so return the aliasNode version preferentially\n    return copyExportVariables(aliasedNode || preAliasingNode);\n  }\n  const {\n    credentials,\n    endpoints,\n    headers,\n    customFetch,\n    operationType,\n    typePatcher,\n    mainDefinition,\n    fragmentDefinitions,\n    fieldNameNormalizer: linkLevelNameNormalizer,\n    fieldNameDenormalizer: linkLevelNameDenormalizer,\n    serializers,\n    responseTransformer,\n  } = context;\n\n  const fragmentMap = createFragmentMap(fragmentDefinitions);\n\n  let {\n    path,\n    endpoint,\n    pathBuilder,\n  } = directives.rest as RestLink.DirectiveOptions;\n\n  const endpointOption = getEndpointOptions(endpoints, endpoint);\n  const neitherPathsProvided = path == null && pathBuilder == null;\n\n  if (neitherPathsProvided) {\n    throw new Error(\n      `One of (\"path\" | \"pathBuilder\") must be set in the @rest() directive. This request had neither, please add one`,\n    );\n  }\n  if (!pathBuilder) {\n    if (!path.includes(':')) {\n      // Colons are the legacy route, and aren't uri encoded anyhow.\n      pathBuilder = PathBuilder.replacerForPath(path);\n    } else {\n      console.warn(\n        \"Deprecated: '@rest(path:' contains a ':' colon, this format will be removed in future versions\",\n      );\n\n      pathBuilder = ({\n        args,\n        exportVariables,\n      }: RestLink.PathBuilderProps): string => {\n        const legacyArgs = {\n          ...args,\n          ...exportVariables,\n        };\n        const pathWithParams = Object.keys(legacyArgs).reduce(\n          (acc, e) => replaceLegacyParam(acc, e, legacyArgs[e]),\n          path,\n        );\n        if (pathWithParams.includes(':')) {\n          throw new Error(\n            'Missing parameters to run query, specify it in the query params or use ' +\n              'an export directive. (If you need to use \":\" inside a variable string' +\n              ' make sure to encode the variables properly using `encodeURIComponent' +\n              '`. Alternatively see documentation about using pathBuilder.)',\n          );\n        }\n        return pathWithParams;\n      };\n    }\n  }\n  const allParams: RestLink.PathBuilderProps = {\n    args,\n    exportVariables,\n    context,\n    '@rest': directives.rest,\n    replacer: pathBuilder,\n  };\n  const pathWithParams = pathBuilder(allParams);\n\n  let {\n    method,\n    type,\n    bodyBuilder,\n    bodyKey,\n    fieldNameDenormalizer: perRequestNameDenormalizer,\n    fieldNameNormalizer: perRequestNameNormalizer,\n    bodySerializer,\n  } = directives.rest as RestLink.DirectiveOptions;\n  if (!method) {\n    method = 'GET';\n  }\n  if (!bodyKey) {\n    bodyKey = 'input';\n  }\n\n  let body = undefined;\n  let overrideHeaders: Headers = undefined;\n  if (-1 === ['GET', 'DELETE'].indexOf(method)) {\n    // Prepare our body!\n    if (!bodyBuilder) {\n      // By convention GraphQL recommends mutations having a single argument named \"input\"\n      // https://dev-blog.apollodata.com/designing-graphql-mutations-e09de826ed97\n\n      const maybeBody =\n        allParams.exportVariables[bodyKey] ||\n        (allParams.args && allParams.args[bodyKey]);\n      if (!maybeBody) {\n        throw new Error(\n          `[GraphQL ${method} ${operationType} using a REST call without a body]. No \\`${bodyKey}\\` was detected. Pass bodyKey, or bodyBuilder to the @rest() directive to resolve this.`,\n        );\n      }\n\n      bodyBuilder = (argsWithExport: object) => {\n        return maybeBody;\n      };\n    }\n\n    body = convertObjectKeys(\n      bodyBuilder(allParams),\n      perRequestNameDenormalizer ||\n        linkLevelNameDenormalizer ||\n        noOpNameNormalizer,\n    );\n\n    let serializedBody: RestLink.SerializedBody;\n\n    if (typeof bodySerializer === 'string') {\n      if (!serializers.hasOwnProperty(bodySerializer)) {\n        throw new Error(\n          '\"bodySerializer\" must correspond to configured serializer. ' +\n            `Please make sure to specify a serializer called ${bodySerializer} in the \"bodySerializers\" property of the RestLink.`,\n        );\n      }\n      serializedBody = serializers[bodySerializer](body, headers);\n    } else {\n      serializedBody = bodySerializer\n        ? bodySerializer(body, headers)\n        : serializers[DEFAULT_SERIALIZER_KEY](body, headers);\n    }\n\n    body = serializedBody.body;\n    overrideHeaders = new Headers(serializedBody.headers);\n  }\n\n  validateRequestMethodForOperationType(method, operationType || 'query');\n\n  const requestParams = {\n    method,\n    headers: overrideHeaders || headers,\n    body: body,\n\n    // Only set credentials if they're non-null as some browsers throw an exception:\n    // https://github.com/apollographql/apollo-link-rest/issues/121#issuecomment-396049677\n    ...(credentials ? { credentials } : {}),\n  };\n  const requestUrl = `${endpointOption.uri}${pathWithParams}`;\n\n  const response = await (customFetch || fetch)(requestUrl, requestParams);\n  context.responses.push(response);\n\n  let result;\n  if (response.ok) {\n    if (\n      response.status === 204 ||\n      response.headers.get('Content-Length') === '0'\n    ) {\n      // HTTP-204 means \"no-content\", similarly Content-Length implies the same\n      // This commonly occurs when you POST/PUT to the server, and it acknowledges\n      // success, but doesn't return your Resource.\n      result = {};\n    } else {\n      result = response;\n    }\n  } else if (response.status === 404) {\n    // In a GraphQL context a missing resource should be indicated by\n    // a null value rather than throwing a network error\n    result = null;\n  } else {\n    // Default error handling:\n    // Throw a JSError, that will be available under the\n    // \"Network error\" category in apollo-link-error\n    let parsed: any;\n    // responses need to be cloned as they can only be read once\n    try {\n      parsed = await response.clone().json();\n    } catch (error) {\n      // its not json\n      parsed = await response.clone().text();\n    }\n    rethrowServerSideError(\n      response,\n      parsed,\n      `Response not successful: Received status code ${response.status}`,\n    );\n  }\n\n  const transformer = endpointOption.responseTransformer || responseTransformer;\n\n  if (transformer) {\n    // A responseTransformer might call something else than json() on the response.\n    try {\n      result = await transformer(result, type);\n    } catch (err) {\n      console.warn('An error occurred in a responseTransformer:');\n      throw err;\n    }\n  } else if (result && result.json) {\n    result = await result.json();\n  }\n\n  result = convertObjectKeys(\n    result,\n    perRequestNameNormalizer || linkLevelNameNormalizer || noOpNameNormalizer,\n  );\n\n  result = findRestDirectivesThenInsertNullsForOmittedFields(\n    resultKey,\n    result,\n    mainDefinition,\n    fragmentMap,\n    mainDefinition.selectionSet,\n  );\n\n  result = addTypeNameToResult(result, type, typePatcher, {\n    resolverParams: { fieldName, root, args, context, info },\n  });\n  return copyExportVariables(result);\n};\n\n/**\n * Default key to use when the @rest directive omits the \"endpoint\" parameter.\n */\nconst DEFAULT_ENDPOINT_KEY = '';\n\n/**\n * Default key to use when the @rest directive omits the \"bodySerializers\" parameter.\n */\nconst DEFAULT_SERIALIZER_KEY = '';\n\nconst DEFAULT_JSON_SERIALIZER: RestLink.Serializer = (\n  data: any,\n  headers: Headers,\n) => {\n  if (!headers.has('content-type')) {\n    headers.append('Content-Type', 'application/json');\n  }\n  return {\n    body: JSON.stringify(data),\n    headers: headers,\n  };\n};\n\nconst CONNECTION_REMOVE_CONFIG = {\n  test: (directive: DirectiveNode) => directive.name.value === 'rest',\n  remove: true,\n};\n\n/**\n * RestLink is an apollo-link for communicating with REST services using GraphQL on the client-side\n */\nexport class RestLink extends ApolloLink {\n  private readonly endpoints: RestLink.Endpoints;\n  private readonly headers: Headers;\n  private readonly fieldNameNormalizer: RestLink.FieldNameNormalizer;\n  private readonly fieldNameDenormalizer: RestLink.FieldNameNormalizer;\n  private readonly typePatcher: RestLink.FunctionalTypePatcher;\n  private readonly credentials: RequestCredentials;\n  private readonly customFetch: RestLink.CustomFetch;\n  private readonly serializers: RestLink.Serializers;\n  private readonly responseTransformer: RestLink.ResponseTransformer;\n  private readonly processedDocuments: Map<DocumentNode, DocumentNode>;\n\n  constructor({\n    uri,\n    endpoints,\n    headers,\n    fieldNameNormalizer,\n    fieldNameDenormalizer,\n    typePatcher,\n    customFetch,\n    credentials,\n    bodySerializers,\n    defaultSerializer,\n    responseTransformer,\n  }: RestLink.Options) {\n    super();\n    const fallback = {};\n    fallback[DEFAULT_ENDPOINT_KEY] = uri || '';\n    this.endpoints = Object.assign({}, endpoints || fallback);\n\n    if (uri == null && endpoints == null) {\n      throw new Error(\n        'A RestLink must be initialized with either 1 uri, or a map of keyed-endpoints',\n      );\n    }\n    if (uri != null) {\n      const currentDefaultURI = (endpoints || {})[DEFAULT_ENDPOINT_KEY];\n      if (currentDefaultURI != null && currentDefaultURI != uri) {\n        throw new Error(\n          \"RestLink was configured with a default uri that doesn't match what's passed in to the endpoints map.\",\n        );\n      }\n      this.endpoints[DEFAULT_ENDPOINT_KEY] = uri;\n    }\n\n    if (this.endpoints[DEFAULT_ENDPOINT_KEY] == null) {\n      console.warn(\n        'RestLink configured without a default URI. All @rest(…) directives must provide an endpoint key!',\n      );\n    }\n\n    if (typePatcher == null) {\n      this.typePatcher = (result, __typename, _2) => {\n        return { __typename, ...result };\n      };\n    } else if (\n      !Array.isArray(typePatcher) &&\n      typeof typePatcher === 'object' &&\n      Object.keys(typePatcher)\n        .map(key => typePatcher[key])\n        .reduce(\n          // Make sure all of the values are patcher-functions\n          (current, patcher) => current && typeof patcher === 'function',\n          true,\n        )\n    ) {\n      const table: RestLink.TypePatcherTable = typePatcher;\n      this.typePatcher = (\n        data: any,\n        outerType: string,\n        patchDeeper: RestLink.FunctionalTypePatcher,\n        context: RestLink.TypePatcherContext,\n      ) => {\n        const __typename = data.__typename || outerType;\n        if (Array.isArray(data)) {\n          return data.map(d =>\n            patchDeeper(d, __typename, patchDeeper, context),\n          );\n        }\n        const subPatcher = table[__typename] || (result => result);\n        return {\n          __typename,\n          ...subPatcher(data, __typename, patchDeeper, context),\n        };\n      };\n    } else {\n      throw new Error(\n        'RestLink was configured with a typePatcher of invalid type!',\n      );\n    }\n\n    if (\n      bodySerializers &&\n      bodySerializers.hasOwnProperty(DEFAULT_SERIALIZER_KEY)\n    ) {\n      console.warn(\n        'RestLink was configured to override the default serializer! This may result in unexpected behavior',\n      );\n    }\n\n    this.responseTransformer = responseTransformer || null;\n    this.fieldNameNormalizer = fieldNameNormalizer || null;\n    this.fieldNameDenormalizer = fieldNameDenormalizer || null;\n    this.headers = normalizeHeaders(headers);\n    this.credentials = credentials || null;\n    this.customFetch = customFetch;\n    this.serializers = {\n      [DEFAULT_SERIALIZER_KEY]: defaultSerializer || DEFAULT_JSON_SERIALIZER,\n      ...(bodySerializers || {}),\n    };\n    this.processedDocuments = new Map();\n  }\n\n  private removeRestSetsFromDocument(query: DocumentNode): DocumentNode {\n    const cached = this.processedDocuments.get(query);\n    if (cached) return cached;\n\n    checkDocument(query);\n\n    const docClone = removeDirectivesFromDocument(\n      [CONNECTION_REMOVE_CONFIG],\n      query,\n    );\n\n    this.processedDocuments.set(query, docClone);\n    return docClone;\n  }\n\n  public request(\n    operation: Operation,\n    forward?: NextLink,\n  ): Observable<FetchResult> | null {\n    const { query, variables, getContext, setContext } = operation;\n    const context: LinkChainContext | any = getContext() as any;\n    const isRestQuery = hasDirectives(['rest'], query);\n    if (!isRestQuery) {\n      return forward(operation);\n    }\n\n    const nonRest = this.removeRestSetsFromDocument(query);\n\n    // 1. Use the user's merge policy if any\n    let headersMergePolicy: RestLink.HeadersMergePolicy =\n      context.headersMergePolicy;\n    if (\n      headersMergePolicy == null &&\n      Array.isArray(context.headersToOverride)\n    ) {\n      // 2.a. Override just the passed in headers, if user provided that optional array\n      headersMergePolicy = makeOverrideHeadersMergePolicy(\n        context.headersToOverride,\n      );\n    } else if (headersMergePolicy == null) {\n      // 2.b Glue the link (default) headers to the request-context headers\n      headersMergePolicy = concatHeadersMergePolicy;\n    }\n\n    const headers = headersMergePolicy(this.headers, context.headers);\n    if (!headers.has('Accept')) {\n      // Since we assume a json body on successful responses set the Accept\n      // header accordingly if it is not provided by the user\n      headers.append('Accept', 'application/json');\n    }\n\n    const credentials: RequestCredentials =\n      context.credentials || this.credentials;\n\n    const queryWithTypename = addTypenameToDocument(query);\n\n    const mainDefinition = getMainDefinition(query);\n    const fragmentDefinitions = getFragmentDefinitions(query);\n\n    const operationType: OperationTypeNode =\n      (mainDefinition || ({} as any)).operation || 'query';\n\n    const requestContext: RequestContext = {\n      headers,\n      endpoints: this.endpoints,\n      // Provide an empty map for this request's exports to be stuffed into\n      exportVariablesByNode: new Map(),\n      credentials,\n      customFetch: this.customFetch,\n      operationType,\n      fieldNameNormalizer: this.fieldNameNormalizer,\n      fieldNameDenormalizer: this.fieldNameDenormalizer,\n      mainDefinition,\n      fragmentDefinitions,\n      typePatcher: this.typePatcher,\n      serializers: this.serializers,\n      responses: [],\n      responseTransformer: this.responseTransformer,\n    };\n    const resolverOptions = {};\n    let obs;\n    if (nonRest && forward) {\n      operation.query = nonRest;\n      obs = forward(operation);\n    } else obs = Observable.of({ data: {} });\n\n    return obs.flatMap(\n      ({ data, errors }) =>\n        new Observable(observer => {\n          graphql(\n            resolver,\n            queryWithTypename,\n            data,\n            requestContext,\n            variables,\n            resolverOptions,\n          )\n            .then(data => {\n              setContext({\n                restResponses: (context.restResponses || []).concat(\n                  requestContext.responses,\n                ),\n              });\n              observer.next({ data, errors });\n              observer.complete();\n            })\n            .catch(err => {\n              if (err.name === 'AbortError') return;\n              if (err.result && err.result.errors) {\n                observer.next(err.result);\n              }\n              observer.error(err);\n            });\n        }),\n    );\n  }\n}\n"],"names":["argumentsObjectFromField","getMainDefinition","getFragmentDefinitions","createFragmentMap","shouldInclude","isField","resultKeyNameFromField","isInlineFragment","qs.stringify","checkDocument","removeDirectivesFromDocument","hasDirectives","addTypenameToDocument","Observable","ApolloLink"],"mappings":"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"}